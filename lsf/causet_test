#!/bin/bash

###########################
#(C) Will Cunningham 2015 #
#         DK Lab          #
# Northeastern University #
###########################

# This is intended to be an example of how to launch 'lsf/causet_bat'

###########################
#  GENERATE NEW NETWORKS  #
###########################

#=================#
# No Acceleration #
#=================#

#./lsf/causet_bat --start 537 --ncores 20 --flags '--nodes 50000 --age 0.5 --stdim 2 --manifold s --link --compact --verbose -y --print --action smeared' --queue 'krioukov' --nsamples 10 --waitfor 534

#==================#
# GPU Acceleration #
#==================#

# Routing Experiments
spacetime=11300
#density=300000
degree=40000
#energy_min=0.73
#energy_max=0.99
jobstart=806
readstart=0
samples=1
queue="krioukov_gpu"
rm -f causet.par
#./etc/routing/gr_test_density $spacetime $density $energy_min $energy_max	//For constant k
./etc/routing/gr_test_degree $spacetime $degree					//For constant q
readarray -t vars < causet.par
rm causet.par
for i in $(seq ${#vars[@]}) ; do
  #energy=$(awk '{print $1}' <<< "${vars[${i}-1]}")
  age=$(awk '{print $1}' <<< "${vars[${i}-1]}")
  nodes=$(awk '{print $2}' <<< "${vars[${i}-1]}")
  job=$(($i+$jobstart-1))
  if [[ "$readstart" -ne 0 ]] ; then
    readjob=$(($i+$readstart-1))
    nodes=0
  else
    readjob=0
  fi
  if [[ "$queue" == "krioukov_gpu" ]] ; then
    ncores=48
  elif [[ "$queue" == "ser-par-10g-3" ]] ; then
    ncores=40
  elif [[ "$queue" == "par-gpu" ]] ; then
    ncores=32
  elif [[ "$queue" == "par-gpu-2" ]] ; then
    ncores=48
  else
    ncores=0
  fi
  ./lsf/wrapper/causet_bat --start $job --readjob $readjob --ncores $ncores --flags '--spacetime '"$spacetime"' --nodes '"$nodes"' --age '"$age"' --link --verbose -y --print --gpu --core 1 --success 100' --queue $queue --nsamples $samples
done

#==================#
# MPI Acceleration #
#==================#

#./lsf/causet_bat --ncores 16 --flags '--nodes 65536 --energy 0.7 --alpha 5 --manifold f --link --verbose -y' --start 510 --mpi 4 --queue 'ser-par-10g'

#=======================#
# GPU, MPI Acceleration #
#=======================#

#./lsf/causet_bat --ncores 48 --flags '--spacetime 11300 --nodes 32768 --age 0.85 --link --gpu --verbose -y --action 5 --seed 18100' --start 59 --mpi 2 --queue 'par-gpu' --nsamples 1

###########################
# STUDY EXISTING NETWORKS #
###########################

#=================#
# No Acceleration #
#=================#

#./lsf/causet_bat --ncores 1 --flags '--age 0.5 --compact --symmetric' --readjob 493 --start 512 --queue 'krioukov'

#==================#
# GPU Acceleration #
#==================#

#./lsf/causet_bat --ncores 32 --flags '--age 0.004 --alpha 1.999657 --manifold f --link --verbose -y --gpu --print --components' --graph 1440081852 --start '209S' --queue 'krioukov' --readjob 209

#==================#
# MPI Acceleration #
#==================#

#./lsf/causet_bat --ncores 40 --flags '--age 1.5 --link --compact --verbose -y --embedding 1 --print' --graph 1426166280 --start 62 --mpi 4 --queue 'ser-par-10g-2' --readjob 61
