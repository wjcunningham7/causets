#!/bin/bash

###########################
#(C) Will Cunningham 2014 #
# Krioukov Research Group #
# Northeastern University #
###########################

#BSUB -J causet.161414
#BSUB -o /scratch/cunningham/causets/job161414/161414.log
#BSUB -e /scratch/cunningham/causets/job161414/161414.err
#BSUB -q par-gpu
#BSUB -cwd /scratch/cunningham/causets/job161414

mkdir /scratch/cunningham/causets/job161414
work=/scratch/cunningham/causets/job161414

cp /home/cunningham.wi/causets/bin/CausalSet $work/

mkdir $work/etc

cp /home/cunningham.wi/causets/etc/degrees $work/etc/
cp /home/cunningham.wi/causets/etc/deg_dist $work/etc/
cp /home/cunningham.wi/causets/etc/components $work/etc/
cp /home/cunningham.wi/causets/etc/clustering $work/etc/
cp /home/cunningham.wi/causets/etc/clust_dist $work/etc/
cp /home/cunningham.wi/causets/etc/migrate $work/etc/

mkdir $work/dat
mkdir $work/dat/cdk
mkdir $work/dat/cls
mkdir $work/dat/dst
mkdir $work/dat/edg
mkdir $work/dat/emb
mkdir $work/dat/emb/fp
mkdir $work/dat/emb/tn
mkdir $work/dat/idd
mkdir $work/dat/odd
mkdir $work/dat/pos
mkdir $work/dat/ref

# Do not edit below this

cd $work
tempfile1=hostlistrun
tempfile2=hostlist-tcp
echo $LSB_MCPU_HOSTS > $tempfile1
declare -a hosts
read -a hosts < ${tempfile1}
for ((i=0; i<${#hosts[@]}; i += 2)) ;
do
	HOST=${hosts[$i]}
	CORE=${hosts[(($i+1))]}
	echo $HOST:$CORE >> $tempfile2
done

# Do not edit above this

./CausalSet --universe --age 0.8458 --alpha 2.01 --delta 10000 --seed 18100 --components --clustering --print --gpu

./etc/degrees uni
./etc/deg_dist 1000887
./etc/components uni
./etc/clustering uni
./etc/clust_dist 1000887
./migrate 161414

# Do not edit below this

rm $work/$tempfile1
rm $work/$tempfile2

# Do not edit above this
